========================================
品类匹配工具 使用说明
========================================

一、工具简介
========================================

本工具用于批量匹配品类。您只需准备好规则表格、已校验品牌表格，以及一份“待匹配品类”列表，运行程序后即可得到匹配结果，并自动生成 Excel 结果文件。

适用场景：需要将大量待匹配品类对照标准原子品类或品牌做归类的场景，例如商品分类、品牌映射等。

========================================
二、文件与目录说明
========================================

程序目录中会包含以下内容，请勿随意删除或改名：

（1）可执行程序
  Windows：CategoryMatching.exe（或所在文件夹中的同名程序）
  macOS / Linux：名为 CategoryMatching 的程序（无 .exe 后缀）

（2）需要您自己准备的文件夹（放在与程序同一目录下）：
  excel 文件夹：用来存放规则表格和已校验品牌表格（两个 Excel 文件）
  model 文件夹：首次使用时可留空，程序会自动下载所需模型；若您已有模型文件，可放入此文件夹
  output 文件夹：程序会把匹配结果 Excel 文件写到这里（若不存在，程序会尝试创建）

（3）可选文件夹：
  config 文件夹：如需使用大模型或外部工具，可将配置文件放在此文件夹中，详见下文“六、config 目录下配置文件说明”
  logs 文件夹：程序运行日志会保存在这里，便于排查问题

（4）本使用说明
  使用说明.txt：即本文件，建议保留在程序目录中以便随时查阅。

========================================
三、使用前准备
========================================

第 1 步：解压或复制得到的程序包到您要使用的目录（建议使用纯英文路径，例如 D:\CategoryMatching，避免中文或特殊符号，可减少报错）。

第 2 步：在程序同一目录下新建三个文件夹，分别命名为：excel、model、output。

第 3 步：准备两个 Excel 文件并放入 excel 文件夹：
  第一个文件：原子品类关键词.xlsx（规则表，用于关键词匹配）
  第二个文件：校验过的品牌对应原子品类.xlsx（已校验品牌表，用于相似度匹配）
  请确保文件名与上述一致，否则程序可能无法找到。

第 4 步：准备一份“待匹配品类”文件。这是一个文本文件，每行写一个品类名称，保存为 UTF-8 编码即可（例如：待匹配品类.txt）。该文件可以放在任意位置，运行时按提示输入其完整路径即可。

完成以上准备后，即可运行程序。

========================================
四、如何运行工具
========================================

Windows 用户
----------------------------------------

第 1 步：确认 excel、model、output 三个文件夹已放在与 CategoryMatching.exe 同一目录下，且 excel 文件夹中已放入上述两个 Excel 文件。

第 2 步：双击 CategoryMatching.exe 启动程序。

第 3 步：会出现一个黑色窗口，这是程序的正常界面，请勿关闭。程序会在窗口中提示您“输入文件路径”或“请拖动或输入待匹配品类文件路径”。

第 4 步：将您的“待匹配品类”文件路径输入到黑色窗口中。可以：
  直接拖动该文件到黑色窗口后按回车；
  或手动输入文件路径（例如 D:\数据\待匹配品类.txt）后按回车。

第 5 步：等待程序处理。处理完成后，程序会提示“已写入”并显示结果文件路径，结果 Excel 文件会保存在 output 文件夹中。

第 6 步：若需继续匹配其他文件，可再次输入新的文件路径；若不再使用，在提示输入时输入 q 后按回车即可退出。

重要：程序运行期间请勿关闭黑色窗口，否则会中断处理。


macOS / Linux 用户
----------------------------------------

第 1 步：确认 excel、model、output 三个文件夹已放在与程序（CategoryMatching）同一目录下，且 excel 文件夹中已放入上述两个 Excel 文件。

第 2 步：打开“终端”（或“命令行”）。

第 3 步：在终端中进入程序所在目录。例如程序在“桌面”的 CategoryMatching 文件夹中，可输入类似以下内容后按回车（具体路径请按您电脑上的实际位置修改）：
  进入程序所在目录的命令一般为 cd 后面加空格再加文件夹路径。

第 4 步：在终端中运行程序。输入程序名称（例如 ./CategoryMatching）后按回车。若系统提示“没有执行权限”，可先在终端中执行一次“赋予执行权限”的步骤（具体可咨询提供程序给您的人员）。

第 5 步：根据窗口中的提示，输入“待匹配品类”文件的完整路径，按回车后等待处理。结果会保存在 output 文件夹中。

第 6 步：不再使用时，在提示输入时输入 q 后按回车即可退出。

========================================
五、输入 Excel 文件说明
========================================

（1）规则表：原子品类关键词.xlsx
  用于按关键词做规则匹配。请按您现有的规则表格式准备，并确保文件名为“原子品类关键词.xlsx”（完全一致），放在 excel 文件夹中。

（2）已校验品牌表：校验过的品牌对应原子品类.xlsx
  用于相似度匹配和计算。请按您现有的已校验品牌表格式准备，并确保文件名为“校验过的品牌对应原子品类.xlsx”，放在 excel 文件夹中。

（3）待匹配品类文件（文本文件）
  任意文本文件，每行写一个品类名称，不要有空行或多余符号。支持 UTF-8 编码。例如：
  品类A
  品类B
  品类C
  程序会逐行读取并匹配，结果汇总到同一份 Excel 中。

========================================
六、config 目录下配置文件说明
========================================

config 文件夹放在与程序同一目录下。程序会在该文件夹中读取以下两个配置文件（均为 JSON 格式）。不配置时程序仍可运行，但不会调用大模型与外部工具；配置后，当相似度匹配结果较低时，程序会尝试调用大模型或外部工具辅助匹配。


（1）大模型配置：llm_config.json
----------------------------------------

作用：当相似度匹配结果不够高时，程序可调用大模型根据品类文本生成描述，再按规则匹配。未配置时该步骤自动跳过。

文件位置：config 文件夹内，文件名为 llm_config.json（必须与此一致）。

文件格式：使用记事本或任意文本编辑器打开后，为 JSON 格式，可包含以下内容（均为英文键名）：

  api_key：大模型接口的 API 密钥，明文填写。若您希望不写明文，可使用下面的 api_key_encrypted。
  api_key_encrypted：加密后的 API 密钥。若由提供方或技术人员为您生成加密串，可只填此项，不填 api_key。
  base_url：大模型接口的地址。例如 OpenAI 兼容接口为 https://api.openai.com/v1；若不填，程序使用默认地址。
  model：模型名称。例如 gpt-3.5-turbo、qwen-plus 等；若不填，程序使用默认模型。

示例（仅作格式参考，请勿直接复制密钥）：
  单行示例：{"api_key":"您的密钥","base_url":"https://api.openai.com/v1","model":"gpt-3.5-turbo"}
  或使用加密密钥：{"api_key_encrypted":"由提供方生成的加密字符串","base_url":"https://...","model":"模型名"}

说明：api_key 与 api_key_encrypted 二选一即可；若两者都不配置，程序不会调用大模型。密钥和地址、模型名请向您的接口提供方或管理员索取。


（2）MCP 外部工具配置：mcp_client_config.json
----------------------------------------

作用：程序可连接外部 MCP 服务器（例如搜索、查询等工具），在调用大模型时使用这些工具辅助匹配。未配置时程序不连接任何外部 MCP 服务器。

文件位置：config 文件夹内，文件名为 mcp_client_config.json（必须与此一致）。

文件格式：JSON，包含一个名为 servers 的数组，数组中每项代表一个 MCP 服务器，可包含：

  name：该服务器的名称，用于区分，可自定。
  transport：连接方式。常见有 sse、streamable-http、stdio 等，具体以提供方说明为准。
  url：当连接方式为通过网页地址连接时填写，例如 https://xxx.xxx/sse。
  command、args：当连接方式为本地命令时填写，一般由技术人员配置。

示例（仅作格式参考）：
  使用网页地址的服务器：
  {"servers":[{"name":"某搜索服务","transport":"sse","url":"https://example.com/sse"}]}

说明：MCP 配置通常由提供程序给您的人员或技术人员填写；若您未收到该文件或说明，可不创建此文件，程序照常运行，仅不使用外部 MCP 工具。


（3）使用与注意
----------------------------------------

  · 两个配置文件均为可选。不需要大模型或外部工具时，可不创建 config 文件夹，或只保留空文件夹。
  · 文件名必须与上述完全一致（含英文大小写、扩展名 .json），否则程序无法识别。
  · 修改配置后需重新启动程序后生效。
  · 配置文件内容涉及密钥或地址，请勿泄露给他人；建议不要将含有真实密钥的 config 文件夹随意外发。

========================================
七、输出结果说明
========================================

匹配完成后，程序会在 output 文件夹中生成一个 Excel 文件。文件名通常为“您输入的文件名_匹配结果_日期时间.xlsx”或“匹配结果_日期时间.xlsx”。

该 Excel 中会包含多列，例如：输入品类、一级原子品类、品类编码、原子品类、匹配方式、相似度匹配结果、大模型描述等。匹配方式可能为“规则”“相似度”或“搜索后匹配”等；未匹配成功的行可能会被标红，便于您后续人工核对。

您可直接用 Excel 或 WPS 打开该文件查看和编辑。

========================================
八、常见问题（FAQ）
========================================

问：双击 exe 没反应或闪退？
答：请确认 excel、model、output 三个文件夹都在 exe 同一目录下，且 excel 里有两个指定名称的 Excel 文件。将整个程序目录移到纯英文路径（如 C:\CategoryMatching）后再试。

问：提示“Failed to load Python DLL”或“LoadLibrary”错误？
答：请依次尝试：（1）把整个程序文件夹移到纯英文路径下；（2）安装 Microsoft Visual C++ 运行库（可搜索“VC++ Redistributable 2015-2022 x64”下载安装）；（3）若从网盘或浏览器下载的压缩包，解压后对程序文件夹右键、属性、勾选“解除锁定”后确定；（4）将程序文件夹加入杀毒软件的排除列表；（5）右键 exe，选择“以管理员身份运行”。

问：程序提示“加载数据失败”？
答：请检查 excel 文件夹中是否有“原子品类关键词.xlsx”和“校验过的品牌对应原子品类.xlsx”，且文件名完全一致（含扩展名）。

问：结果 Excel 在哪里？
答：在程序同目录下的 output 文件夹中。若未看到，请检查程序运行时是否有报错，或查看 logs 文件夹中的当日日志文件。

问：黑色窗口可以关吗？
答：程序正在处理时请勿关闭。处理完成并提示“已写入”后，若不再继续输入文件，可输入 q 回车退出，或直接关闭窗口。

========================================
九、注意事项
========================================

（1）请尽量将程序放在纯英文路径下使用，避免路径中含有中文、空格或特殊符号，以减少无法启动或报错的情况。

（2）两个 Excel 规则文件的文件名必须与说明中一致，且放在 excel 文件夹内，否则程序无法识别。

（3）待匹配品类文件请使用“每行一个品类”的文本格式，并保存为 UTF-8 编码。

（4）程序运行期间请勿关闭黑色窗口（或终端窗口），否则会中断本次处理。

（5）若您需要配置大模型或外部工具，请将 llm_config.json、mcp_client_config.json 放入 config 文件夹，格式与说明见上文“六、config 目录下配置文件说明”；具体取值可向提供程序的人员咨询。

（6）本说明面向最终使用者，仅介绍如何操作程序。若您需要开发或二次打包，请参阅项目中的其他文档。

========================================
如有疑问，请联系提供本程序给您的人员。
========================================
